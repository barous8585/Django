{% extends 'api/base_v2.html' %}

{% block content %}
<style>
    .detail-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 15px;
        margin-bottom: 30px;
    }
    .detail-header h2 {
        font-size: 2em;
        margin-bottom: 10px;
    }
    .progress-bar {
        width: 100%;
        height: 30px;
        background: rgba(255,255,255,0.3);
        border-radius: 15px;
        overflow: hidden;
        margin: 20px 0;
    }
    .progress-fill {
        height: 100%;
        background: #28a745;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        transition: width 0.3s ease;
    }
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    .info-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #667eea;
    }
</style>

<div class="detail-header">
    <h2>ğŸ“¦ {{ conteneur.nom }}</h2>
    <p style="opacity: 0.9;">{{ conteneur.get_etape_display }}</p>
    
    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ progression }}%;">
            {{ progression }}%
        </div>
    </div>
    
    <div style="display: flex; justify-content: space-between; margin-top: 20px;">
        <div>
            <strong>Objectif:</strong> {{ conteneur.objectif|floatformat:0 }} {{ conteneur.devise }}
        </div>
        <div>
            <strong>CollectÃ©:</strong> {{ conteneur.montant_actuel|floatformat:0 }} GNF
        </div>
        <div>
            <strong>Manquant:</strong> {{ montant_manquant|floatformat:0 }} GNF
        </div>
    </div>
</div>

<div class="info-grid">
    <div class="info-card">
        <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š Statistiques</h3>
        <div class="data-item">
            <span class="data-label">Participants</span>
            <span class="data-value">{{ total_participants }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">Participations validÃ©es</span>
            <span class="data-value">{{ participations_validees }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">En attente</span>
            <span class="data-value">{{ participations_attente }}</span>
        </div>
    </div>
    
    <div class="info-card">
        <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ’° Finances</h3>
        <div class="data-item">
            <span class="data-label">Devise</span>
            <span class="data-value">{{ conteneur.get_devise_display }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">Objectif GNF</span>
            <span class="data-value">{{ objectif_gnf|floatformat:0 }} GNF</span>
        </div>
        <div class="data-item">
            <span class="data-label">Montant moyen</span>
            <span class="data-value">{{ montant_moyen|floatformat:0 }} GNF</span>
        </div>
    </div>
    
    <div class="info-card">
        <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“… Dates</h3>
        <div class="data-item">
            <span class="data-label">CrÃ©Ã© le</span>
            <span class="data-value">{{ conteneur.date_creation|date:"d/m/Y" }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">Heure</span>
            <span class="data-value">{{ conteneur.date_creation|date:"H:i" }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">Statut</span>
            <span class="data-value">
                {% if conteneur.annule %}
                <span class="badge badge-danger">âœ— AnnulÃ©</span>
                {% else %}
                <span class="badge badge-success">âœ“ Actif</span>
                {% endif %}
            </span>
        </div>
    </div>
</div>

<h2 style="margin: 40px 0 20px;">ğŸ‘¥ Liste des Participants</h2>

{% if participations %}
<div class="data-grid">
    {% for participation in participations %}
    <div class="data-card">
        <h3>ğŸ¤ {{ participation.utilisateur.telephone }}</h3>
        <div class="data-item">
            <span class="data-label">Montant</span>
            <span class="data-value"><strong>{{ participation.montant|floatformat:0 }} GNF</strong></span>
        </div>
        <div class="data-item">
            <span class="data-label">RÃ©fÃ©rence</span>
            <span class="data-value">{{ participation.reference_paiement }}</span>
        </div>
        <div class="data-item">
            <span class="data-label">Statut</span>
            <span class="data-value">
                {% if participation.valide %}
                <span class="badge badge-success">âœ“ ValidÃ©</span>
                {% else %}
                <span class="badge badge-warning">â³ En attente</span>
                {% endif %}
            </span>
        </div>
        <div class="data-item">
            <span class="data-label">Date</span>
            <span class="data-value">{{ participation.date_participation|date:"d/m/Y H:i" }}</span>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <p>Aucune participation pour ce conteneur</p>
</div>
{% endif %}

<div style="margin-top: 30px; text-align: center;">
    <a href="/api/conteneurs/" style="display: inline-block; padding: 15px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 10px;">
        â† Retour Ã  la liste
    </a>
</div>
{% endblock %}
